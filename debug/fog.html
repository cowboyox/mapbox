<!DOCTYPE html>
<html>
<head>
    <title>Mapbox GL JS debug page</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel='stylesheet' href='../dist/mapbox-gl.css' />
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
        .mapboxgl-canvas {
            background-color: blue;
        }
    </style>
</head>

<body>
<div id='map'></div>

<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js'></script>
<script src='../dist/mapbox-gl-dev.js'></script>
<script src='access_token_generated.js'></script>
<script>

var GUIParams = function() {
    this.enableFog = true;
    this.style = 'streets-v11';
    this.start = 0.8;
    this.end = 2.5;
    this.color = [255, 255, 255];
    this.skyColor = [0, 0, 0];
    this.opacity = 1.0;
    this.skyOpacity = 1.0;
    this.horizonBlend = 0.5;
    this.starIntensity = 5.0;
    this.starDensity = 0.0;
    this.starScale = 1.0;
    this.presets = 'preset1';
};

var guiParams = new GUIParams();

var map = window.map = new mapboxgl.Map({
    container: 'map',
    zoom: 10,
    center: [78.7193, 36.2927],
    pitch: 75,
    bearing: -10,
    style: 'mapbox://styles/mapbox/streets-v11',
    hash: true,
    projection: 'globe'
});

function updateFog() {
    map.setStyle('mapbox://styles/mapbox/' + guiParams.style);
}

function updatePreset(value) {
    if (value === 'preset1') {
        guiParams.enableFog = true;
        guiParams.style = 'satellite-streets-v11';
        guiParams.start = 0.46;
        guiParams.end = 2.9;
        guiParams.color = [220, 159, 159];
        guiParams.skyColor = [36, 92, 223];
        guiParams.opacity = 1.0;
        guiParams.skyOpacity = 0.7;
        guiParams.horizonBlend = 1.15;
        guiParams.starIntensity = 5.6;
        guiParams.starDensity = 0;
        guiParams.starScale = 1.0;
    } else if (value === 'preset2') {
        guiParams.enableFog = true;
        guiParams.style = 'streets-v11';
        guiParams.start = 0.79;
        guiParams.end = 2.2;
        guiParams.color = [255, 255, 255];
        guiParams.skyColor = [19, 122, 255];
        guiParams.opacity = 1;
        guiParams.skyOpacity = 1;
        guiParams.horizonBlend = 1.9;
        guiParams.starIntensity = 1;
        guiParams.starDensity = 0;
        guiParams.starScale = 0.5;
    } else if (value === 'preset3') {
        guiParams.enableFog = true;
        guiParams.style = 'light-v10';
        guiParams.start = 0.46;
        guiParams.end = 2.9;
        guiParams.color = [0, 0, 0];
        guiParams.skyColor = [200, 200, 200];
        guiParams.opacity = 1;
        guiParams.skyOpacity = 1;
        guiParams.horizonBlend = 0.3;
        guiParams.starIntensity = 10.0;
        guiParams.starDensity = 3;
        guiParams.starScale = 0.87;
    }
    updateFog();
}

updatePreset('preset1');

window.onload = function() {
    var gui = new dat.GUI(); // eslint-disable-line

    var presets = gui.add(guiParams, 'presets', [
        'preset1',
        'preset2',
        'preset3',
        'preset4'
    ]);

    presets.onFinishChange((value) => {
        updatePreset(value);
    });

    var fog = gui.addFolder('Fog');
    var enableFog = fog.add(guiParams, 'enableFog');
    enableFog.onFinishChange((value) => {
        map.setFog(value ? {
            "range": [guiParams.start, guiParams.end],
            "color": 'rgba(' + guiParams.color[0] + ', ' + guiParams.color[1] + ', ' + guiParams.color[2] + ', ' + guiParams.opacity + ')',
            "horizon-blend": guiParams.horizonBlend
        } : null);
    });

    var start = fog.add(guiParams, 'start', 0, 5);
    start.onChange((value) => {
        map.setFog({
            "range": [value, guiParams.end],
        });
    });

    var end = fog.add(guiParams, 'end', 0, 5);
    end.onChange((value) => {
        map.setFog({
            "range": [guiParams.start, value],
        });
    });

    var horizonBlend = fog.add(guiParams, 'horizonBlend', 0.0, 10.0);
    horizonBlend.onChange((value) => {
        map.setFog({
            "horizon-blend": value,
        });
    });
    var starDensity = fog.add(guiParams, 'starDensity', 0.0, 5.0);
    starDensity.onChange((value) => {
        map.setFog({
            "star-density": value,
        });
    });
    var starIntensity = fog.add(guiParams, 'starIntensity', 0.0, 10.0);
    starIntensity.onChange((value) => {
        map.setFog({
            "star-intensity": value,
        });
    });
    var starScale = fog.add(guiParams, 'starScale', 0.5, 1.0);
    starScale.onChange((value) => {
        map.setFog({
            "star-scale": value,
        });
    });

    var opacity = fog.add(guiParams, 'opacity', 0.0, 1.0);
    opacity.onChange((value) => {
        map.setFog({
            "color": 'rgba(' + guiParams.color[0] + ', ' + guiParams.color[1] + ', ' + guiParams.color[2] + ', ' + value + ')'
        });
    });
    var skyOpacity = fog.add(guiParams, 'skyOpacity', 0.0, 1.0);
    skyOpacity.onChange((value) => {
        map.setFog({
            "sky-color": 'rgba(' + guiParams.skyColor[0] + ', ' + guiParams.skyColor[1] + ', ' + guiParams.skyColor[2] + ', ' + value + ')'
        });
    });

    var color = fog.addColor(guiParams, 'color');
    color.onChange((value) => {
        map.setFog({
            "color": 'rgba(' + value[0] + ', ' + value[1] + ', ' + value[2] + ', ' + guiParams.opacity + ')'
        });
    });
    var skyColor = fog.addColor(guiParams, 'skyColor');
    skyColor.onChange((value) => {
        map.setFog({
            "sky-color": 'rgba(' + value[0] + ', ' + value[1] + ', ' + value[2] + ', ' + guiParams.skyOpacity + ')'
        });
    });
};

map.on('style.load', function() {
    map.setFog({
        "range": [guiParams.start, guiParams.end],
        "color": 'rgba(' + guiParams.color[0] + ', ' + guiParams.color[1] + ', ' + guiParams.color[2] + ', ' + guiParams.opacity + ')',
        "horizon-blend": guiParams.horizonBlend,
        "sky-color": 'rgba(' + guiParams.skyColor[0] + ', ' + guiParams.skyColor[1] + ', ' + guiParams.skyColor[2] + ', ' + guiParams.skyOpacity + ')',
        "star-intensity": guiParams.starIntensity,
        "star-density": guiParams.starDensity,
        "star-scale": guiParams.starScale
    });
});

</script>
</body>
</html>
