<!DOCTYPE html>
<html>
<head>
    <title>Mapbox GL JS debug page</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; padding: 0; }
        html, body { height: 100%; }
    </style>
    <link href='https://api.mapbox.com/mapbox-assembly/v1.0.1/assembly.min.css' rel='stylesheet'>
    <script async defer src='https://api.mapbox.com/mapbox-assembly/v1.0.1/assembly.js'></script>
</head>

<body>
<div id='map'></div>
<form id='printOpts' class="py6 px6 border round border--gray-light w300 bg-blue-faint my12 mx12">
  <div class='txt-bold txt-ms mb6'>Map options</div>
  <div class='txt-bold txt-s w24 inline-block'>W</div>
  <input class='input input--s w240 mb6 bg-white inline-block' id='width' placeholder='2800' />
  <br />
  <div class='txt-bold txt-s w24 inline-block'>H</div>
  <input class='input input--s w240 mb6 bg-white inline-block' id='height' placeholder='1200' />
  <br />
  <div class='txt-bold txt-s w24 inline-block'>DPI</div>
  <input class='input input--s w240 mb6 bg-white inline-block' id='height' placeholder='227' />
  <button class='btn round btn--s' onClick='handleClick()'>Download</button>
</form>
<script src='https://unpkg.com/downloadjs@1.4.7/download.js'></script>
<script src='../dist/mapbox-gl-dev.js'></script>
<script src='../debug/access_token_generated.js'></script>
<script>
const handleClick = () => {
  const form = document.getElementById('printOpts');
  const width = form.elements['width'].value;
  const height = form.elements['height'].value;

  const worker = new Worker('./offscreen-print.js');

  const postToWorker = () => {
    worker.postMessage({
      width: width,
      height: height
    });
  }

  postToWorker();

  worker.onmessage = function(data) {
    if(data.data.renderResult) {
      download(data.data.renderResult, 'print.png', 'image/png');
    }
  }
}
</script>
</body>
</html>
