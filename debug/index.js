const data = [
  {
    "shape": [
      [
        -74.07350147054707,
        40.64622950449007
      ],
      [
        -74.07559864235911,
        40.645290865141185
      ],
      [
        -74.07552642710029,
        40.643532498631345
      ],
      [
        -74.0733571996835,
        40.64271276902958
      ],
      [
        -74.07126010171166,
        40.643651338634065
      ],
      [
        -74.07133215731588,
        40.645409707581926
      ],
      [
        -74.07350147054707,
        40.64622950449007
      ]
    ],
    "value": 23
  },
  {
    "shape": [
      [
        -73.90423087546569,
        40.85968095579109
      ],
      [
        -73.90634071396359,
        40.858743120260876
      ],
      [
        -73.9062745395645,
        40.85698006037253
      ],
      [
        -73.90409868779932,
        40.856154834105695
      ],
      [
        -73.90198892465871,
        40.85709259992966
      ],
      [
        -73.90205493792557,
        40.85885566172389
      ],
      [
        -73.90423087546569,
        40.85968095579109
      ]
    ],
    "value": 11
  },
  {
    "shape": [
      [
        -73.89361476502631,
        40.86260651541517
      ],
      [
        -73.8957249294511,
        40.86166884563209
      ],
      [
        -73.89565915046344,
        40.85990572291851
      ],
      [
        -73.89348336820389,
        40.85908026811243
      ],
      [
        -73.89137327919852,
        40.86001786820229
      ],
      [
        -73.89143889703287,
        40.86178099278862
      ],
      [
        -73.89361476502631,
        40.86260651541517
      ]
    ],
    "value": 82
  },
  {
    "shape": [
      [
        -74.07285242174237,
        40.63040542235063
      ],
      [
        -74.07494889961941,
        40.62946696934184
      ],
      [
        -74.07487673299893,
        40.627708953559655
      ],
      [
        -74.07270824804812,
        40.62688938834709
      ],
      [
        -74.07061184396478,
        40.627827771628404
      ],
      [
        -74.07068385103804,
        40.629585789846956
      ],
      [
        -74.07285242174237,
        40.63040542235063
      ]
    ],
    "value": 4
  },
  {
    "shape": [
      [
        -73.90198892465871,
        40.85709259992966
      ],
      [
        -73.90409868779932,
        40.856154834105695
      ],
      [
        -73.90403260142261,
        40.85439183135251
      ],
      [
        -73.9018569130195,
        40.85356659252143
      ],
      [
        -73.899747225239,
        40.85450428864508
      ],
      [
        -73.89981315050106,
        40.85626729329727
      ],
      [
        -73.90198892465871,
        40.85709259992966
      ]
    ],
    "value": 3
  },
  {
    "shape": [
      [
        -73.89526458041975,
        40.849327799896116
      ],
      [
        -73.89737411747157,
        40.84839024315522
      ],
      [
        -73.89730829504728,
        40.84662741185674
      ],
      [
        -73.89513309663266,
        40.84580213541801
      ],
      [
        -73.89302363494937,
        40.84673962247649
      ],
      [
        -73.8930892963117,
        40.84850245565329
      ],
      [
        -73.89526458041975,
        40.849327799896116
      ]
    ],
    "value": 64
  },
  {
    "shape": [
      [
        -73.899747225239,
        40.85450428864508
      ],
      [
        -73.9018569130195,
        40.85356659252143
      ],
      [
        -73.90179091464604,
        40.8518036469116
      ],
      [
        -73.89961538958872,
        40.850978395530475
      ],
      [
        -73.89750577717115,
        40.851916021959774
      ],
      [
        -73.89757161444751,
        40.85367896946173
      ],
      [
        -73.899747225239,
        40.85450428864508
      ]
    ],
    "value": 10
  },
  {
    "shape": [
      [
        -73.89770330385622,
        40.85720498065458
      ],
      [
        -73.89981315050106,
        40.85626729329727
      ],
      [
        -73.899747225239,
        40.85450428864508
      ],
      [
        -73.89757161444751,
        40.85367896946173
      ],
      [
        -73.89546184318445,
        40.85461658712507
      ],
      [
        -73.89552760733066,
        40.85637959366291
      ],
      [
        -73.89770330385622,
        40.85720498065458
      ]
    ],
    "value": 82
  },
  {
    "shape": [
      [
        -73.89585650227178,
        40.86519520722056
      ],
      [
        -73.89796674211318,
        40.86425746773831
      ],
      [
        -73.89790087511761,
        40.8624942878853
      ],
      [
        -73.8957249294511,
        40.86166884563209
      ],
      [
        -73.89361476502631,
        40.86260651541517
      ],
      [
        -73.893680470851,
        40.8643696971478
      ],
      [
        -73.89585650227178,
        40.86519520722056
      ]
    ],
    "value": 8
  },
  {
    "shape": [
      [
        -73.89750577717115,
        40.851916021959774
      ],
      [
        -73.89961538958872,
        40.850978395530475
      ],
      [
        -73.8995494791994,
        40.849215507072216
      ],
      [
        -73.89737411747157,
        40.84839024315522
      ],
      [
        -73.89526458041975,
        40.849327799896116
      ],
      [
        -73.89533032972953,
        40.8510906902396
      ],
      [
        -73.89750577717115,
        40.851916021959774
      ]
    ],
    "value": 7
  },
  {
    "shape": [
      [
        -73.90014285120294,
        40.865082897424465
      ],
      [
        -73.9022530075219,
        40.86414507944228
      ],
      [
        -73.90218697935661,
        40.86238190148228
      ],
      [
        -73.90001095604163,
        40.861556539608635
      ],
      [
        -73.89790087511761,
        40.8624942878853
      ],
      [
        -73.89796674211318,
        40.86425746773831
      ],
      [
        -73.90014285120294,
        40.865082897424465
      ]
    ],
    "value": 7
  },
  {
    "shape": [
      [
        -74.08203458474459,
        40.645991502706565
      ],
      [
        -74.08413158908935,
        40.64505270858448
      ],
      [
        -74.08405905452547,
        40.64329434699041
      ],
      [
        -74.08188967526814,
        40.642474777051135
      ],
      [
        -74.07979274472066,
        40.643413501416426
      ],
      [
        -74.07986511963273,
        40.64517186547498
      ],
      [
        -74.08203458474459,
        40.645991502706565
      ]
    ],
    "value": 62
  },
  {
    "shape": [
      [
        -73.89302363494937,
        40.84673962247649
      ],
      [
        -73.89513309663266,
        40.84580213541801
      ],
      [
        -73.89506736215426,
        40.84403936128752
      ],
      [
        -73.89289232703658,
        40.84321407234126
      ],
      [
        -73.89078294072465,
        40.844151489723274
      ],
      [
        -73.89084851415863,
        40.8459142657252
      ],
      [
        -73.89302363494937,
        40.84673962247649
      ]
    ],
    "value": 5
  },
  {
    "shape": [
      [
        -74.07487673299893,
        40.627708953559655
      ],
      [
        -74.07697305344144,
        40.626770492953035
      ],
      [
        -74.0769008151584,
        40.6250125368644
      ],
      [
        -74.07473241596102,
        40.624193038936866
      ],
      [
        -74.07263616929377,
        40.62513142981574
      ],
      [
        -74.07270824804812,
        40.62688938834709
      ],
      [
        -74.07487673299893,
        40.627708953559655
      ]
    ],
    "value": 52
  },
  {
    "shape": [
      [
        -74.07755115440459,
        40.64083554480008
      ],
      [
        -74.07964801115182,
        40.639896890185675
      ],
      [
        -74.0795756524938,
        40.63813864301754
      ],
      [
        -74.07740659670549,
        40.637319048010326
      ],
      [
        -74.07530981376149,
        40.63825763287979
      ],
      [
        -74.07538201280208,
        40.64001588249863
      ],
      [
        -74.07755115440459,
        40.64083554480008
      ]
    ],
    "value": 15
  },
  {
    "shape": [
      [
        -73.87792964201896,
        40.84448692262096
      ],
      [
        -73.8800392784488,
        40.843549740565194
      ],
      [
        -73.87997411498128,
        40.84178701805734
      ],
      [
        -73.87779947611384,
        40.840961475777945
      ],
      [
        -73.87568991512302,
        40.84189858818222
      ],
      [
        -73.87575491756022,
        40.84366131251457
      ],
      [
        -73.87792964201896,
        40.84448692262096
      ]
    ],
    "value": 52
  },
  {
    "shape": [
      [
        -73.90607604622778,
        40.851691113071325
      ],
      [
        -73.90818549165341,
        40.85075332975552
      ],
      [
        -73.90811925910855,
        40.84899044510773
      ],
      [
        -73.90594374221482,
        40.84816534186103
      ],
      [
        -73.90383437211165,
        40.84910305547577
      ],
      [
        -73.9039004435793,
        40.850865942035476
      ],
      [
        -73.90607604622778,
        40.851691113071325
      ]
    ],
    "value": 45
  },
  {
    "shape": [
      [
        -73.8995494791994,
        40.849215507072216
      ],
      [
        -73.90165893278858,
        40.848277871890815
      ],
      [
        -73.90159294930348,
        40.84651504248401
      ],
      [
        -73.89941767328955,
        40.8456898463641
      ],
      [
        -73.89730829504728,
        40.84662741185674
      ],
      [
        -73.89737411747157,
        40.84839024315522
      ],
      [
        -73.8995494791994,
        40.849215507072216
      ]
    ],
    "value": 12
  },
  {
    "shape": [
      [
        -74.08586550899865,
        40.63532257139158
      ],
      [
        -74.08796196702092,
        40.63438382422961
      ],
      [
        -74.08788930545236,
        40.632625698910125
      ],
      [
        -74.08572034543991,
        40.631806318273235
      ],
      [
        -74.0836239611625,
        40.63274499568354
      ],
      [
        -74.08369646315217,
        40.634503123479625
      ],
      [
        -74.08586550899865,
        40.63532257139158
      ]
    ],
    "value": 2
  },
  {
    "shape": [
      [
        -73.88708740215502,
        40.86012985463158
      ],
      [
        -73.8891975746161,
        40.8591923330361
      ],
      [
        -73.88913204475297,
        40.857429265604296
      ],
      [
        -73.88695650356526,
        40.85660371791266
      ],
      [
        -73.88484640654809,
        40.85754116982723
      ],
      [
        -73.8849117752743,
        40.85930423911152
      ],
      [
        -73.88708740215502,
        40.86012985463158
      ]
    ],
    "value": 2
  },
  {
    "shape": [
      [
        -73.90403260142261,
        40.85439183135251
      ],
      [
        -73.90614220569715,
        40.8534540567757
      ],
      [
        -73.90607604622778,
        40.851691113071325
      ],
      [
        -73.9039004435793,
        40.850865942035476
      ],
      [
        -73.90179091464604,
        40.8518036469116
      ],
      [
        -73.9018569130195,
        40.85356659252143
      ],
      [
        -73.90403260142261,
        40.85439183135251
      ]
    ],
    "value": 4
  },
  {
    "shape": [
      [
        -74.07530981376149,
        40.63825763287979
      ],
      [
        -74.07740659670549,
        40.637319048010326
      ],
      [
        -74.07733432597203,
        40.63556085806738
      ],
      [
        -74.0751654318943,
        40.63474125054729
      ],
      [
        -74.07306872275655,
        40.63567976567772
      ],
      [
        -74.07314083388978,
        40.63743795806448
      ],
      [
        -74.07530981376149,
        40.63825763287979
      ]
    ],
    "value": 134
  },
  {
    "shape": [
      [
        -74.08427667451122,
        40.64856954864832
      ],
      [
        -74.08637375265025,
        40.64763068476354
      ],
      [
        -74.08630113010504,
        40.64587226596871
      ],
      [
        -74.08413158908935,
        40.64505270858448
      ],
      [
        -74.08203458474459,
        40.645991502706565
      ],
      [
        -74.08210704762077,
        40.64774992397277
      ],
      [
        -74.08427667451122,
        40.64856954864832
      ]
    ],
    "value": 14
  },
  {
    "shape": [
      [
        -73.90179091464604,
        40.8518036469116
      ],
      [
        -73.9039004435793,
        40.850865942035476
      ],
      [
        -73.90383437211165,
        40.84910305547577
      ],
      [
        -73.90165893278858,
        40.848277871890815
      ],
      [
        -73.8995494791994,
        40.849215507072216
      ],
      [
        -73.89961538958872,
        40.850978395530475
      ],
      [
        -73.90179091464604,
        40.8518036469116
      ]
    ],
    "value": 4
  },
  {
    "shape": [
      [
        -73.89565915046344,
        40.85990572291851
      ],
      [
        -73.89776915598969,
        40.858968044341374
      ],
      [
        -73.89770330385622,
        40.85720498065458
      ],
      [
        -73.89552760733066,
        40.85637959366291
      ],
      [
        -73.893417677205,
        40.85731720254645
      ],
      [
        -73.89348336820389,
        40.85908026811243
      ],
      [
        -73.89565915046344,
        40.85990572291851
      ]
    ],
    "value": 4
  },
  {
    "shape": [
      [
        -74.07711754622876,
        40.63028652207061
      ],
      [
        -74.07921394044355,
        40.62934799173034
      ],
      [
        -74.0791416142772,
        40.62758997839775
      ],
      [
        -74.07697305344144,
        40.626770492953035
      ],
      [
        -74.07487673299893,
        40.627708953559655
      ],
      [
        -74.07494889961941,
        40.62946696934184
      ],
      [
        -74.07711754622876,
        40.63028652207061
      ]
    ],
    "value": 4
  },
  {
    "shape": [
      [
        -73.90218697935661,
        40.86238190148228
      ],
      [
        -73.9042969767565,
        40.86144407471915
      ],
      [
        -73.90423087546569,
        40.85968095579109
      ],
      [
        -73.90205493792557,
        40.85885566172389
      ],
      [
        -73.89994501590182,
        40.85979341878114
      ],
      [
        -73.90001095604163,
        40.861556539608635
      ],
      [
        -73.90218697935661,
        40.86238190148228
      ]
    ],
    "value": 4
  }
];

const collection = {
    type: 'FeatureCollection',
    features: []
};

for (const d of data) {
    collection.features.push({
        type: 'Feature',
        properties: { height: d.value * 90 },
        geometry: {
            type: 'Polygon',
            coordinates: [d.shape]
        }
    });
}

const viewState = {
  longitude: -73.9,
  latitude: 40.84,
  zoom: 11,
  pitch: 60,
  bearing: -30
}

const layerProps = {
  type: deck.PolygonLayer,
  id: 'hex',
  data,
  getPolygon: d => d.shape,
  getFillColor: [123, 145, 230, 255],
  opacity: 1,
  extruded: true,
  getElevation: d => 100 * d.value,
};

const deckgl = new deck.DeckGL({
  container: document.getElementById('deckgl'),
  mapboxApiAccessToken: 'pk.eyJ1IjoidWJlcmRhdGEiLCJhIjoiY2o4OW90ZjNuMDV6eTMybzFzbmc3bWpvciJ9.zfRO_nfL1O3d2EuoNtE_NQ',
  mapStyle: 'mapbox://styles/mapbox/light-v9',
  viewState,
  layers: [new layerProps.type(layerProps)]
});

const map = new mapboxgl.Map({
  container: 'mapbox',
  antialias: true,
  style: 'mapbox://styles/mapbox/light-v9',
  center: [viewState.longitude, viewState.latitude],
  zoom: viewState.zoom,
  pitch: viewState.pitch,
  bearing: viewState.bearing
});

const map2 = new mapboxgl.Map({
  container: 'mapbox2',
  antialias: true,
  style: 'mapbox://styles/mapbox/light-v9',
  center: [viewState.longitude, viewState.latitude],
  zoom: viewState.zoom,
  pitch: viewState.pitch,
  bearing: viewState.bearing
});

map.on('load', () => {
  map.addLayer(new deck.MapboxLayer(layerProps));
});

map2.on('load', () => {
  map2.addLayer(new deck.MapboxLayer(layerProps));
  map2.addLayer({
      id: 'extrusions',
      type: 'fill-extrusion',
      source: {
          type: 'geojson',
          data: collection
      },
      paint: {
          'fill-extrusion-translate': [-10, -10],
          'fill-extrusion-color': 'rgba(123, 145, 230, 1)',
          'fill-extrusion-height': ["get", "height"]
      }
  });
});
